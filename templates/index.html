{% extends "base.html" %}
{% block content %}
    {% if user.is_authenticated %}
        <section id="feed" class="py-10">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="flex flex-col lg:flex-row gap-6 relative">
                    <!-- Left Sidebar - Fixed on desktop, dropdown on mobile -->
                    <div class="lg:w-1/4 mb-6 lg:mb-0">
                        <div class="lg:sticky lg:top-4 bg-white p-4 rounded-lg shadow-md">
                            <div class="flex justify-between items-center">
                                <h3 class="font-semibold text-lg mb-4">Popular Topics</h3>
                                <button class="lg:hidden text-gray-600" onclick="toggleSidebar('topics')">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                            </div>
                            <ul id="topics-menu" class="space-y-2 hidden lg:block">
                                <li><a href="#" class="text-blue-600 hover:underline">#Mathematics</a></li>
                                <li><a href="#" class="text-blue-600 hover:underline">#Science</a></li>
                                <li><a href="#" class="text-blue-600 hover:underline">#Literature</a></li>
                                <li><a href="#" class="text-blue-600 hover:underline">#History</a></li>
                                <li><a href="#" class="text-blue-600 hover:underline">#Geography</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Main Feed - Scrollable -->
                    <div class="w-full lg:w-2/4 mx-auto max-w-2xl">
                        <!-- Posts Feed -->
                        <!-- Add this form section above the shared files table -->
                        <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-6">
                            <h2 class="text-xl font-semibold mb-4">Share Learning Materials</h2>
                            <form method="post" enctype="multipart/form-data" class="space-y-4">
                                {% csrf_token %}
                                {{ form.as_p }}
                                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
                                    Share Material
                                </button>
                            </form>
                        </div>

                        <!-- Display shared files -->
                        <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-4">Shared Materials</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-2 sm:px-4 py-2 text-left">Name</th>
                                            <th class="hidden sm:table-cell px-4 py-2 text-left">Description</th>
                                            <th class="hidden md:table-cell px-4 py-2 text-left">Shared By</th>
                                            <th class="hidden sm:table-cell px-4 py-2 text-left">Date</th>
                                            <th class="px-2 sm:px-4 py-2 text-left">Downloads</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for file in shared_files %}
                                        <tr class="border-t">
                                            <td class="px-2 sm:px-4 py-2">
                                                <a href="{{ file.file.url }}" class="text-blue-600 hover:underline">
                                                    {{ file.name }}
                                                </a>
                                            </td>
                                            <td class="hidden sm:table-cell px-4 py-2">{{ file.description|truncatechars:50 }}</td>
                                            <td class="hidden md:table-cell px-4 py-2">{{ file.user.username }}</td>
                                            <td class="hidden sm:table-cell px-4 py-2">{{ file.uploaded_at|date:"M d, Y" }}</td>
                                            <td class="px-2 sm:px-4 py-2">{{ file.download_count }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="px-4 py-2 text-center text-gray-500">
                                                No materials shared yet
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Right Sidebar - Fixed on desktop, dropdown on mobile -->
                    <div class="lg:w-1/4 mt-6 lg:mt-0">
                        <div class="lg:sticky lg:top-4 bg-white p-4 rounded-lg shadow-md">
                            <div class="flex justify-between items-center">
                                <h3 class="font-semibold text-lg mb-4">Suggested Connections</h3>
                                <button class="lg:hidden text-gray-600" onclick="toggleSidebar('connections')">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                            </div>
                            <ul id="connections-menu" class="space-y-4 hidden lg:block">
                                <li class="flex items-center flex-wrap sm:flex-nowrap">
                                    <img src="https://images.pexels.com/photos/11940641/pexels-photo-11940641.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="User Avatar" class="w-10 h-10 rounded-full mr-4">
                                    <div class="min-w-0 flex-1">
                                        <h4 class="font-semibold truncate">Herbal Expert</h4>
                                        <p class="text-sm text-gray-500">500+ connections</p>
                                    </div>
                                    <button class="mt-2 sm:mt-0 w-full sm:w-auto bg-blue-600 text-white px-3 py-1 rounded-full text-sm hover:bg-green-700 transition">Connect</button>
                                </li>
                                <li class="flex items-center flex-wrap sm:flex-nowrap">
                                    <img src="https://images.pexels.com/photos/11940641/pexels-photo-11940641.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="User Avatar" class="w-10 h-10 rounded-full mr-4">
                                    <div class="min-w-0 flex-1">
                                        <h4 class="font-semibold truncate">Nature's Healer</h4>
                                        <p class="text-sm text-gray-500">200+ connections</p>
                                    </div>
                                    <button class="mt-2 sm:mt-0 w-full sm:w-auto bg-blue-600 text-white px-3 py-1 rounded-full text-sm hover:bg-green-700 transition">Connect</button>
                                </li>
                                <li class="flex items-center flex-wrap sm:flex-nowrap">
                                    <img src="https://images.pexels.com/photos/11940641/pexels-photo-11940641.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="User Avatar" class="w-10 h-10 rounded-full mr-4">
                                    <div class="min-w-0 flex-1">
                                        <h4 class="font-semibold truncate">Holistic Health Pro</h4>
                                        <p class="text-sm text-gray-500">350+ connections</p>
                                    </div>
                                    <button class="mt-2 sm:mt-0 w-full sm:w-auto bg-blue-600 text-white px-3 py-1 rounded-full text-sm hover:bg-green-700 transition">Connect</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script>
            function toggleSidebar(id) {
                const menu = document.getElementById(`${id}-menu`);
                menu.classList.toggle('hidden');
            }
        </script>
    {% else %}
        <section class="min-h-screen bg-gradient-to-b from-green-50 to-white">
            <div class="container mx-auto px-4 sm:px-6 py-20">
                <div class="text-center mb-16">
                    <h1 class="text-4xl sm:text-5xl font-bold text-gray-800 mb-4">Welcome to SocialConnect</h1>
                    <p class="text-lg sm:text-xl text-gray-600 mb-8">Connect with Student, share resourses, and explore more</p>
                    <div class="space-y-4 sm:space-y-0 sm:space-x-4">
                        <a href="{% url 'login' %}" class="inline-block w-full sm:w-auto bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition">Login</a>
                        <a href="{% url 'register' %}" class="inline-block w-full sm:w-auto bg-white text-blue-600 px-8 py-3 rounded-lg border border-blue-600 hover:bg-green-50 transition">Sign Up</a>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4">Share Knowledge</h3>
                        <p class="text-gray-600">Connect with a community of herbal enthusiasts and share your experiences.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4">Learn & Grow</h3>
                        <p class="text-gray-600">Access valuable insights and traditional wisdom from experienced herbalists.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4">Build Network</h3>
                        <p class="text-gray-600">Create meaningful connections with like-minded individuals in the herbal community.</p>
                    </div>
                </div>
            </div>
        </section>
    {% endif %}
{% endblock %}